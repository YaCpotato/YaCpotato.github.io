<html>
    <head>
        <title>ET Scheduler</title>
        <script src="https://kit.fontawesome.com/fff52c779c.js" crossorigin="anonymous"></script>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.2/css/bulma.min.css">

        <script src="https://cdn.jsdelivr.net/npm/vue@2.6.12/dist/vue.js"></script>
        <script type="text/javascript" src="https://unpkg.com/vue-simple-suggest"></script>
        <link rel="stylesheet" href="https://unpkg.com/vue-simple-suggest/dist/styles.css">

    </head>
    <body>
        <div id="app" class="container">
            <div class="time-area box">
                <div class="mini-rt-area">
                    <span id="RealtimeClockArea"></span>
                </div>
                <div class="clock-area">
                    <span id="ETClockArea"></span>
                </div>
                <div class="">
                    <div class="field has-addons">
                        <div class="control">
                          <vue-simple-suggest
                            v-model="selected"
                            :list="simpleSuggestionList"
                            :filter-by-query="true">
                            </vue-simple-suggest>
                        </div>
                        <div class="control">
                          <button class="button is-info" @click="addItem()">
                            追加
                          </button>
                        </div>
                      </div>
                </div>
            </div>
            <div class="gantt-area box">
                <table class="list-table" rules="all">
                    <thead>
                        <th>name</th>
                    </thead>
                    <tbody>
                        <tr v-for="(item,index) in myItem" :key="index">
                            <td>{{ item.name }}</td>
                        </tr>
                    </tbody>
                </table>
                <table class="listchart-table" rules="all">
                    <tr id = "hourArea" colspan="24"></tr>
                    <tr v-for="(item, index) in myItem" :key="index">
                        <td id="n1"></td>
                        <td id="n2"></td>
                        <td id="n3"></td>
                        <td id="n4"></td>
                        <td id="n5"></td>
                        <td id="n6"></td>
                        <td id="n7"></td>
                        <td id="n8"></td>
                        <td id="n9"></td>
                        <td id="n10"></td>
                        <td id="n11"></td>
                        <td id="n12"></td>
                        <td id="n13"></td>
                        <td id="n14"></td>
                        <td id="n15"></td>
                        <td id="n16"></td>
                        <td id="n17"></td>
                        <td id="n18"></td>
                        <td id="n19"></td>
                        <td id="n20"></td>
                        <td id="n21"></td>
                        <td id="n22"></td>
                        <td id="n23"></td>
                        <td id="n24"></td>
                    </tr>
                </table>
            </div>
        </div>
    </body>
    <script>
        const items = '{"item1": {"name":"aaa","et-begin":2,"time":2},"item2": {"name":"aaa","et-begin":2,"time":2},"item3": {"name":"aaa","et-begin":2,"time":2}}'
        const itemsJson = JSON.parse(items);

        var app = new Vue({
            el:"#app",
            data:{
                selected:'',
                simpleSuggestionList:[
                    "item1",
                    "item2",
                    "item3"
                ],
                myItem:[]
            },
            methods:{
                addItem(){
                    result = itemsJson[this.selected]

                    for(var i = parseInt(result["et-begin"]);i<parseInt(result["et-begin"]+parseInt(result.time));i++) {
                        document.getElementById(`n${i}`).innerHTML = "★";
                    }
                    this.myItem.push({
                        "name":result.name,
                        "et-begin":result["et-begin"],
                        "during":result.time,
                        "time":tmpTime
                    })
                }
            }
        })


        function set2fig(num) {
            // 桁数が1桁だったら先頭に0を加えて2桁に調整する
            var ret;
            if( num < 10 ) { ret = "0" + num; }
            else { ret = num; }
            return ret;
        }
        function showClock() {
            // 現在時刻を#RealtimeClockArea表示する
            var nowTime = new Date();
            var nowHour = set2fig( nowTime.getHours() );
            var nowMin  = set2fig( nowTime.getMinutes() );
            var nowSec  = set2fig( nowTime.getSeconds() );
            var msg = nowHour + ":" + nowMin + ":" + nowSec;
            document.getElementById("RealtimeClockArea").innerHTML = msg;
        }
        function ETClock() {
            var date = new Date();
            var a = date.getTime();
            var ut = Math.floor(a/1000);

            //エオルゼア時間1/1/1 00:00:00から経過した秒数を求める
            et_seconds = ut * 60.0 / 175.0
            //エオルゼア時間1/1/1 00:00:00から経過した時間を求める
            et_hours = ut / 175.0
            //エオルゼア時間1/1/1 00:00:00から経過した日数を求める
            et_days = et_hours / 24.0
            //エオルゼア時間1/1/1 00:00:00から経過した月数を求める
            et_months = et_days / 32.0
            //エオルゼア時間の時刻を計算する
            et_hour = et_hours % 24.0
            et_minute = et_seconds % 60.0

            //print("%4d-%02d-%02d %02d:%02d" % (int, int(), int(), int(et_hour), int(et_minute)))
            var result = {
                hour:parseInt(et_hour),
                minute:parseInt(et_minute)
            }
            return result
        }
        function showETClock() {
                var et_time = ETClock()
                var hour = set2fig(et_time.hour)
                var minute = set2fig(et_time.minute)
                var msg = hour + ":" + minute;
                document.getElementById("ETClockArea").innerHTML = msg;
        }

        function calUpdate() {
            result = []
            now = ETClock()
            start = now.hour

            var contentBlock = document.getElementById('hourArea')

            reflesh = false
            refleshTime = start
            
            if(start != 0) {
                reflesh = true
            }

            for(var i = start;i <= 23;i++) {
                var new_element = document.createElement('td')
                new_element.classList.add('hour-seg')
                new_element.textContent = `${i}`
                contentBlock.appendChild(new_element)

                if(i == 23 && reflesh == true) {
                    for(var j = 0;j <= start - 1;j++) {
                        var new_element = document.createElement('td')
                        new_element.classList.add('hour-seg')
                        new_element.textContent = `${j}`
                        contentBlock.appendChild(new_element)
                    }
                }
            }
        }
        
        function update() {
            showETClock()
            showClock()
        }
        setInterval("update()",1000)
        calUpdate()
    </script>
    <style>
        * {
            box-sizing: border-box;
        }
        .container {
            width:100vw;
            height:100vh;
        }
        .time-area {
            width:40%;
        }
        .mini-rt-area {
            float:right;
        }
        .clock-area {
            font-size:28px;
            font-weight:bold;
        }
        .gantt-area {
            display:flex;
        }
        .list-area {
            width:40%;
        }
        .chart-area {
            width:60%;
        }
        .list-table {
            table-layout: fixed;
            width: 20%;
        }
        .listchart-table {
            table-layout: fixed;
            width: 80%;
        }
        .listchart-table td {
            background-color: lightgray;
        }
        #hourArea {
            padding:0px;
        }
        td.hour-seg {
            padding-right:0.7rem;
            padding-left:0.7rem;
        }
    </style>
</html>